{% extends 'global/sidebar.html' %}
{% load static %}

{% block content %}
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-[#FF7690]">DETALHES DO CLIENTE</h1>
    <div class="space-x-2">
      <a href="{% url 'customer:customer_update' customer.pk %}" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors inline-block">
        Editar Cliente
      </a>
      <a href="{% url 'customer:customer_delete' customer.pk %}" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium transition-colors inline-block">
        Excluir Cliente
      </a>
      <a href="{% url 'customer:customer_list' %}" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors inline-block">
        Voltar
      </a>
    </div>
  </div>

  {% if messages %}
    <div class="mb-4">
      {% for message in messages %}
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
          <span class="block sm:inline">{{ message }}</span>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Informações Principais -->
    <div class="lg:col-span-2">
      <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-300 mb-6">
        <h2 class="text-lg font-semibold text-[#555555] mb-4 border-b pb-2">Dados Pessoais</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm font-medium text-gray-500">Nome Completo</p>
            <p class="text-base text-gray-900">{{ customer.name }}</p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">CPF/CNPJ</p>
            <p class="text-base text-gray-900">{{ customer.cpf_cnpj }}</p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">Data de Nascimento</p>
            <p class="text-base text-gray-900">
              {% if customer.birth_date %}
                {{ customer.birth_date|date:"d/m/Y" }}
              {% else %}
                -
              {% endif %}
            </p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">Data Prevista do Parto</p>
            <p class="text-base text-gray-900">
              {% if customer.baby_due_date %}
                {{ customer.baby_due_date|date:"d/m/Y" }}
              {% else %}
                -
              {% endif %}
            </p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">E-mail</p>
            <p class="text-base text-gray-900">{{ customer.email }}</p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">Telefone/WhatsApp</p>
            <p class="text-base text-gray-900">{{ customer.phone|default:"-" }}</p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">Preferências de Tamanho</p>
            <p class="text-base text-gray-900">{{ customer.size_preferences|default:"-" }}</p>
          </div>

          <div class="md:col-span-2">
            <p class="text-sm font-medium text-gray-500">Observações</p>
            <p class="text-base text-gray-900">{{ customer.note|default:"-" }}</p>
          </div>
        </div>
      </div>

      <!-- Endereços -->
      <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-300 mb-6">
        <h2 class="text-lg font-semibold text-[#555555] mb-4 border-b pb-2">Endereços</h2>
        
        {% if addresses %}
          <div class="space-y-4">
            {% for address in addresses %}
              <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                <p class="text-sm text-gray-900">
                  <span class="font-medium">CEP:</span> {{ address.cep }}<br>
                  <span class="font-medium">Endereço:</span> {{ address.street }}, {{ address.number }}
                  {% if address.complement %} - {{ address.complement }}{% endif %}<br>
                  <span class="font-medium">Bairro:</span> {{ address.neighborhood }}<br>
                  <span class="font-medium">Cidade/Estado:</span> {{ address.city }}/{{ address.state }}
                </p>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-gray-500 italic">Nenhum endereço cadastrado.</p>
        {% endif %}
      </div>
    </div>

    <!-- Histórico e Estatísticas -->
    <div class="lg:col-span-1">
      <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-300 mb-6">
        <h2 class="text-lg font-semibold text-[#555555] mb-4 border-b pb-2">Resumo de Compras</h2>
        
        <div class="space-y-4">
          <div class="bg-rose-50 rounded-lg p-4 border border-rose-200">
            <p class="text-sm font-medium text-gray-600">Valor Total Gasto</p>
            <p class="text-2xl font-bold text-rose-600">R$ {{ total_spent|floatformat:2 }}</p>
          </div>

          <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <p class="text-sm font-medium text-gray-600">Total de Compras</p>
            <p class="text-2xl font-bold text-blue-600">{{ purchase_frequency.total_purchases }}</p>
          </div>

          <div class="bg-green-50 rounded-lg p-4 border border-green-200">
            <p class="text-sm font-medium text-gray-600">Média Mensal</p>
            <p class="text-2xl font-bold text-green-600">{{ purchase_frequency.average_per_month|floatformat:1 }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-300 mb-6">
        <h2 class="text-lg font-semibold text-[#555555] mb-4 border-b pb-2">Informações de Cadastro</h2>
        
        <div class="space-y-2">
          <div>
            <p class="text-sm font-medium text-gray-500">Cadastrado em</p>
            <p class="text-sm text-gray-900">{{ customer.created_at|date:"d/m/Y H:i" }}</p>
          </div>

          <div>
            <p class="text-sm font-medium text-gray-500">Última atualização</p>
            <p class="text-sm text-gray-900">{{ customer.updated_at|date:"d/m/Y H:i" }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Histórico de Compras -->
  <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-300">
    <h2 class="text-lg font-semibold text-[#555555] mb-4 border-b pb-2">Histórico de Compras</h2>
    
    {% if purchase_history %}
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-[#F7E8EB]">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-[#555555] uppercase border border-gray-300">Data</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-[#555555] uppercase border border-gray-300">Produtos</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-[#555555] uppercase border border-gray-300">Valor Total</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for sale in purchase_history %}
              <tr class="hover:bg-rose-50">
                <td class="px-4 py-2 text-sm text-gray-900 border border-gray-300">{{ sale.date|date:"d/m/Y" }}</td>
                <td class="px-4 py-2 text-sm text-gray-900 border border-gray-300">{{ sale.items_count }} item(s)</td>
                <td class="px-4 py-2 text-sm text-right font-medium text-rose-600 border border-gray-300">R$ {{ sale.total|floatformat:2 }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-8">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="mt-4 text-gray-500 italic">
          Histórico de compras será exibido após integração com o módulo de PDV/Vendas.
        </p>
      </div>
    {% endif %}
  </div>

  <!-- Produtos Favoritos -->
  {% if favorite_products %}
    <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-300 mt-6">
      <h2 class="text-lg font-semibold text-[#555555] mb-4 border-b pb-2">Produtos Favoritos</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for product in favorite_products %}
          <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
            <p class="font-medium text-gray-900">{{ product.name }}</p>
            <p class="text-sm text-gray-500">Comprado {{ product.purchase_count }}x</p>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endblock %}

