{% extends 'base/base.html' %}
{% load static %}

{% block content %}
<div class="pr-20 pl-20">
  <style>
    /* botão olho sem borda e sem efeito de hover */
    .btn-eye {
      border: none !important;
      background: transparent !important;
      padding: 0.25rem 0.35rem !important;
      color: var(--cor-fonte-cinza) !important;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none !important;
    }
    .btn-eye:hover, .btn-eye:focus {
      color: var(--cor-fonte-cinza) !important;
      background: transparent !important;
      box-shadow: none !important;
      text-decoration: none !important;
    }
    .btn-eye svg { vertical-align: middle; }
    /* centralizar conteúdo das células da tabela */
    .customer-list td, .customer-list th { text-align: center !important; }
  </style>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="titulo">LISTA DE CLIENTES</h1>
  </div>

  <form method="GET" action="{% url 'customer:customer_list' %}" class="mb-4 d-flex justify-content-end">
    <div class="position-relative w-100" style="max-width:400px;">
      <input type="text" id="search_right" name="search" value="{{ search }}" class="form-control rounded-pill bg-transparent pe-4" placeholder="Pesquisar" style="color: var(--cor-fonte-cinza) !important;">
      <button type="submit" aria-label="Pesquisar" class="position-absolute end-0 top-50 translate-middle-y border-0 bg-transparent p-0 pe-3" style="color: var(--cor-fonte-cinza) !important;">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5" width="20" height="20" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M11 18.5a7.5 7.5 0 100-15 7.5 7.5 0 000 15z" />
        </svg>
      </button>
    </div>
  </form>

  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-success" role="alert">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="rounded-4 shadow-sm border border-light overflow-hidden">
    <table class="table table-bordered align-middle mb-0 text-center customer-list">
      <thead>
        <tr class="cabecalho text-center text-uppercase text-secondary">
          <th>Visualizar</th>
          <th>Nome</th>
          <th>CPF/CNPJ</th>
          <th>Telefone</th>
          <th>Data Prevista do Parto</th>
        </tr>
      </thead>
      <tbody>
        {% for customer in customers %}
        <tr class="align-middle" style="cursor:default;">
          <td class="d-flex justify-content-center align-items-center">
            <a href="{% url 'customer:customer_detail' customer.pk %}" class="btn-eye" title="Visualizar Detalhes" aria-label="Visualizar {{ customer.name }}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="feather feather-eye" aria-hidden="true">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </a>
          </td>

          <td>{{ customer.name }}</td>
          <td>{{ customer.cpf_cnpj }}</td>
          <td>{{ customer.phone|default:"-" }}</td>
          <td>
            {% if customer.baby_due_date %}
              {{ customer.baby_due_date|date:"d/m/Y" }}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted py-4">Nenhum cliente encontrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <div class="mt-4 d-flex justify-content-center">
      <nav class="">
        {% if page_obj.has_previous %}
          <a href="?page=1{% if search %}&search={{ search }}{% endif %}" class="btn btn-sm btn-outline-secondary me-1">Primeira</a>
          <a href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}" class="btn btn-sm btn-outline-secondary me-1">Anterior</a>
        {% endif %}

        <span class="btn btn-sm btn-light">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}" class="btn btn-sm btn-outline-secondary ms-1">Próxima</a>
          <a href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}" class="btn btn-sm btn-outline-secondary ms-1">Última</a>
        {% endif %}
      </nav>
    </div>
  {% endif %}
{% endblock %}

